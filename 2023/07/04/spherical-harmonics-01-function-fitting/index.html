<!DOCTYPE html><html class="appearance-dark" lang="zh-CN"><head><meta charset="UTF-8"><title>球谐函数 - 01 函数拟合</title><meta name="description" content="walking in pixels"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/favicon.ico"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><link rel="stylesheet" href="/style/common/jquery.fancybox.min.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="计算机应用常常需要使用简单函数的线性组合来拟合某个复杂函数。例如，在游戏开发中，为了实现某些渲染效果，通常会在shader中使用到正弦函数。但是，由于GPU计算正弦函数的指令数较多，性能开销比较高，开发者通常会考虑使用多项式函数$x^{n}$的线性组合来拟合正弦函数，从而减少计算指令数，提高渲染性能。
假设我们需要计算正弦函数$f(x) &amp;#x3D; \sin(x)$在区间$\lbrack - \pi,\pi\rbrack$上的值。为了减少性能开销，我们考虑使用多项式函数$x^{n}$的线性组合来逼近函数$\sin(x)$，如[approxsin]{.ref}所示。
$$\overset{\sim}{f}(x) &amp;#x3D; \sum_{i &amp;#x3D; 0}^{n}c_{i}x^{i}$$
线性组合系数$.."><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="walking in pixels" type="application/atom+xml">
</head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">Leptus He's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">球谐函数 - 01 函数拟合</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">点击返回顶部</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile is-hidden"></div><div class="column is-9"><header class="my-4"></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">球谐函数 - 01 函数拟合</h1><time class="has-text-grey" datetime="2023-07-04T13:01:14.000Z">2023-07-04</time><article class="mt-2 post-content"><p>计算机应用常常需要使用简单函数的线性组合来拟合某个复杂函数。例如，在游戏开发中，为了实现某些渲染效果，通常会在shader中使用到正弦函数。但是，由于GPU计算正弦函数的指令数较多，性能开销比较高，开发者通常会考虑使用多项式函数$x^{n}$的线性组合来拟合正弦函数，从而减少计算指令数，提高渲染性能。</p>
<p>假设我们需要计算正弦函数$f(x) &#x3D; \sin(x)$在区间$\lbrack - \pi,\pi\rbrack$上的值。为了减少性能开销，我们考虑使用多项式函数$x^{n}$的线性组合来逼近函数$\sin(x)$，如<a href="#approxsin">[approxsin]</a>{.ref}<br>所示。</p>
<p>$$\overset{\sim}{f}(x) &#x3D; \sum_{i &#x3D; 0}^{n}c_{i}x^{i}$$</p>
<p>线性组合系数$c_{i}$的取值应该使得函数$f(x)$与$\overset{\sim}{f}(x)$之间的误差最小。因此，我们先定义误差函数$g(x)$，然后求得误差函数$g(x)$的最小值点，即可以得到线性组合系数$c_{i}$。</p>
<p>$$g(x) &#x3D; \int_{- 2\pi}^{2\pi}\left( f(x) - \overset{\sim}{f}(x) \right)^{2}$$</p>
<p>由于函数$g(x)$的最小值点必定在极小值点取得，因此求函数$g(x)$的最小值点的一种方法是，求$g(x)$的导数为0的点。另外，我们还可以使用其他方法来求解系数$c_{i}$，该方法称为<br>最小二乘投影，这是后面重点介绍的方法。</p>
<p>对于函数$\sin(x)$，我们可以使用多项式函数$P_{i}(x)$的线性组合来拟合，其中$P_{i}(x)$的定义如公式所示。</p>
<p>$$\begin{cases}<br>P_{0}(x) &#x3D; \frac{1}{\sqrt{2\pi}} \<br>P_{1}(x) &#x3D; \frac{\sqrt{\frac{3}{2}}x}{\pi^{\frac{3}{2}}} \<br>P_{2}(x) &#x3D; \frac{3\sqrt{\frac{5}{2}}\left( x^{2} - \frac{\pi^{2}}{3} \right)}{2\pi^{\frac{5}{2}}} \<br>P_{3}(x) &#x3D; \frac{5\sqrt{\frac{7}{2}}\left( x^{3} - \frac{3\pi^{2}x}{5} \right)}{2\pi^{\frac{7}{2}}} \<br> \vdots<br>\end{cases}$$</p>
<p>所有在区间$\lbrack - \pi,\pi\rbrack$上有定义的一元连续函数能够构成函数空间$L(R)$，而函数$P_{i}(x)$是该函数空间中的基函数。这意味着函数空间$L(R)$中的任意函数，都可以使用基函数$P_{i}(x)$的线性组合来表示，即</p>
<p>$$\sin(x) &#x3D; \sum_{i &#x3D; 0}^{\infty}c_{i}P_{i}(x)$$</p>
<p>虽然函数$\sin(x)$需要使用无穷项基函数$P_{i}(x)$的线性组合来表示，但是实际上，我们取基函数的前$n$项也能够很好地来拟合函数$\sin(x)$。为了方便起见，我们取前$4$项基函数$P_{i}(x)$的线性组合来进行拟合，可以表示为：</p>
<p>$$\sin(x) \approx \overset{\sim}{f}(x) &#x3D; \sum_{i &#x3D; 0}^{3}c_{i}P_{i}(x)$$</p>
<p>另外，由于函数空间的基函数会满足正交性质，则函数$P_{i}(x)$应该满足性质：</p>
<p>$$\int_{- \pi}^{\pi}P_{i}(x)P_{j}(x)dx &#x3D; \delta_{i,j}$$</p>
<p>其中$\delta_{i,j}$的定义如下：</p>
<p>$$\delta_{i,j} &#x3D; \begin{cases}<br>1\quad\text{ if  }i \neq j \<br>0\quad\text{ if  }i &#x3D; j<br>\end{cases}$$</p>
<p>基于多项式函数$P_{i}(x)$的正交性，我们可以通过以下公式求得线性组合系数$c_{i}$：<br>$$c_{i} &#x3D; \int_{- \pi}^{\pi}\sin(x)P_{i}(x)dx$$ [] &amp;#123 #coefficient &amp;#125</p>
<p><a href="#coefficient">[coefficient]</a>{.ref} 的证明如下： $$\begin{aligned}<br>c_{i} &amp; &#x3D; \int_{- \pi}^{\pi}\sin(x)P_{i}(x)dx \<br> &amp; &#x3D; \int_{\pi}^{\pi}\left( \sum_{k &#x3D; 0}^{\infty}c_{k}P_{k}(x) \right)P_{i}(x)dx \<br> &amp; &#x3D; \int_{\pi}^{\pi}\sum_{k &#x3D; 0}^{\infty}\left( c_{k}P_{k}(x)P_{i}(x) \right)dx \<br> &amp; &#x3D; c_{i}\int_{\pi}^{\pi}P_{i}^{2}(x)dx \<br> &amp; &#x3D; c_{i}<br>\end{aligned}$$</p>
<p>通过 <a href="#coefficient">[coefficient]</a>{.ref}<br>，我们可以得到函数$\overset{\sim}{f}(x)$中的系数如下：<br>$$c_{0} &#x3D; 1,c_{1} &#x3D; 0,c_{2} &#x3D; \sqrt{\frac{6}{\pi}},c_{3} &#x3D; 0$$</p>
<p>带入到<br><a href="#approx-eq">[approx-eq]</a>{.ref}，可以得到函数$\overset{\sim}{f}(x)$的公式如下：</p>
<p>$$\begin{aligned}<br>\overset{\sim}{f}(x) &amp; &#x3D; \left( \frac{315}{2\pi^{4}} - \frac{15}{2\pi^{2}} \right)x + \left( \frac{35}{2} - \frac{525}{2\pi^{6}} \right)x^{3} \<br> &amp; \approx 0.856983x - 0.0933877x^{3}<br>\end{aligned}$$</p>
<p><a href="#img-sin-fitting-4">[img-sin-fitting-4]</a>{.ref}是函数$\sin(x)$与$\overset{\sim}{f}(x)$在区间$\lbrack - \pi,\pi\rbrack$的图像，其中黄色曲线为函数$\sin(x)$，绿色曲线为函数$\overset{\sim}{f}(x)$。可以看到，函数$\overset{\sim}{f}(x)$能够较好地拟合函数$\sin(x)$。</p>
<figure>
<p><img src="image/spherical-harmonics/01-function-fitting/sin-fitting-4.png" style="width:60.0%" /></p>
<figcaption><p>正弦函数拟合 - 4项</p></figcaption>
</figure>


[]{#img-sin-fitting-4}


<p>事实上，通过增加多项式函数$P_{i}(x)$的数量，我们可以不断地提高函数$\overset{\sim}{f}(x)$对函数$f(x)$的拟合程度。当多项式的数量是$6$个时，即函数$\overset{\sim}{f}(x) &#x3D; \sum_{i &#x3D; 0}^{5}c_{i}P_{i}(x)$时，函数图像如<br><a href="#img-sin-fitting-6-term">[img-sin-fitting-6-term]</a>{.ref}<br>所示。从图像可以看出，函数$\sin(x)$与$\overset{\sim}{f}(x)$的曲线几乎一致。我们取<br><a href="#img-sin-fitting-6-term">[img-sin-fitting-6-term]</a>{.ref}<br>中的局部区间$\left\lbrack \frac{3\pi}{10},\frac{7\pi}{10} \right\rbrack$，如<br><a href="#img-sin-fitting-6-term-local">[img-sin-fitting-6-term-local]</a>{.ref}<br>所示，可以看到函数$\sin(x)$与$\overset{\sim}{f}(x)$的曲线误差也很小。事实上，通过增加多项式函数$P_{i}(x)$的数量，我们可以不断地提高函数$\overset{\sim}{f}(x)$对函数$f(x)$的拟合程度。当多项式的数量是$6$个时，即函数$\overset{\sim}{f}(x) &#x3D; \sum_{i &#x3D; 0}^{5}c_{i}P_{i}(x)$时，函数图像如<br><a href="#img-sin-fitting-6-term">[img-sin-fitting-6-term]</a>{.ref}</p>
<figure>
<p><img src="image/spherical-harmonics/01-function-fitting/sin-fitting-6.png" style="width:60.0%" /></p>
<figcaption><p>正弦函数拟合 - 6项</p></figcaption>
</figure>


[]{#img-sin-fitting-6-term}


<p>当函数$\overset{\sim}{f}(x)$中多项式函数$P_{i}(x)$的项数趋于无穷时，其极限为$\sin(x)$，能够完美地拟合函数$\sin(x)$。</p>
<figure>
<p><img src="image/spherical-harmonics/01-function-fitting/sin-fitting-6-local.png"
style="width:60.0%" /></p>
<figcaption><p>正弦函数拟合(局部) - 6项</p></figcaption>
</figure>


[]{#img-sin-fitting-6-term-local}
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><em></em><a class="button is-default" href="/2019/03/11/temporal-antialiasing-02/" title="Temporal Antialiasing - 02"><span class="has-text-weight-semibold">下一页: Temporal Antialiasing - 02</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="LeptusHe/LeptusHe.github.io.git" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><a title="twitter" target="_blank" rel="noopener nofollow" href="//twitter.com//"><i class="iconfont icon-twitter"></i></a><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/LeptusHe"><i class="iconfont icon-github"></i></a><!-- Ins--><a title="instagram" target="_blank" rel="noopener nofollow" href="//www.instagram.com//"><i class="iconfont icon-ins"></i></a><!-- RSS--><!-- 知乎--><a title="zhihu" target="_blank" rel="noopener nofollow" href="//zhihu.com//"><i class="iconfont icon-zhihu"></i></a><!-- 领英--><!-- 脸书--><a title="facebook" target="_blank" rel="noopener nofollow" href="//www.facebook.com//"><i class="iconfont icon-tian7_facebook"></i></a></section><p><span>Copyright ©</span><span> Leptus He 2023</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" target="_blank" rel="noopener" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" target="_blank" rel="noopener" href="https://github.com/haojen/hexo-theme-Claudia" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/jquery-3.6.1.min.js"></script><script src="/js/jquery-fancybox.min.js"></script><script src="/js/img_zoom.js"></script><script src="/js/post.js"></script></body></html>