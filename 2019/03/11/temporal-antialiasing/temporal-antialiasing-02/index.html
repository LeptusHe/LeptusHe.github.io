<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author"><title>Temporal Antialiasing - 02 · Walking in Pixels</title><meta name="description" content="window.typstBindSvgDom = function () {};
window.captureStack = function () {
  return undefined;
};
let appContainer = document.currentScript &amp;&amp; d"><meta name="og:description" content="window.typstBindSvgDom = function () {};
window.captureStack = function () {
  return undefined;
};
let appContainer = document.currentScript &amp;&amp; d"><meta name="twitter:site" content="Walking in Pixels"><meta name="twitter:title" content="Temporal Antialiasing - 02"><meta name="twitter:card" content="summary"><meta name="keywords" content=""><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont/style.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="/css/style-dark.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><!-- hexo injector head_end start --><style>.typst-app {
  margin: 0;
  --typst-dom-scale: 1;
  /* --typst-dom-scale: 1.5; */
  margin: 5px;
}

.typst-dom-page {
  width: calc(var(--data-page-width, 100%) * var(--typst-dom-scale));
  height: calc(var(--data-page-height) * var(--typst-dom-scale));
  --data-text-width: calc(1px * var(--typst-dom-scale));
  --data-text-height: calc(1px * var(--typst-dom-scale));
}

.typst-back-canvas {
  position: absolute;
  z-index: -1;
  width: calc(var(--data-page-width, 100%) * var(--typst-dom-scale));
  height: calc(var(--data-page-height) * var(--typst-dom-scale));
  pointer-events: none;
}

.typst-svg-page {
  position: absolute;
  z-index: 0;
  width: calc(var(--data-page-width, 100%) * var(--typst-dom-scale));
  height: calc(var(--data-page-height) * var(--typst-dom-scale));
}

.typst-html-semantics {
  position: absolute;
  z-index: 2;
  width: calc(var(--data-page-width, 100%) * var(--typst-dom-scale));
  height: calc(var(--data-page-height) * var(--typst-dom-scale));
  color: transparent;
  font-family: monospace;
  white-space: pre;
  opacity: 0.62;
}

.typst-html-semantics span {
  color: transparent;
  font-family: monospace;
  transform-origin: left top;
  position: absolute;
  display: inline-block;
  left: 0;
  top: 0;
}

.typst-content-hint {
  position: absolute;
  display: inline-block;
  width: 1px;
  height: 1px;
  overflow: hidden;
}

.typst-html-semantics a {
  position: absolute;
  display: inline-block;
}

/* set transparent itself */
.typst-content-group {
  pointer-events: visible;
}

.typst-html-semantics span::-moz-selection {
  color: transparent;
  background: #7db9dea0;
}

.typst-html-semantics span::selection {
  color: transparent;
  background: #7db9de;
}

.typst-html-semantics *::-moz-selection {
  color: transparent;
  background: transparent;
}

.typst-html-semantics *::selection {
  color: transparent;
  background: transparent;
}

.typst-content-fallback {
  color: transparent;
  background: transparent;
}

.pseudo-link,
.typst-text {
  pointer-events: none;
}

.tsel span,
.tsel {
  left: 0;
  position: fixed;
  text-align: justify;
  white-space: pre;
  width: 100%;
  height: 100%;
  text-align-last: justify;
  color: transparent;
}
.tsel span::-moz-selection,
.tsel::-moz-selection {
  color: transparent;
  background: #7db9dea0;
}
.tsel span::selection,
.tsel::selection {
  color: transparent;
  background: #7db9dea0;
}
.pseudo-link {
  fill: transparent;
  cursor: pointer;
  pointer-events: all;
}
svg {
  fill: none;
}

.outline_glyph path,
path.outline_glyph {
  fill: var(--glyph_fill);
  stroke: var(--glyph_stroke);
}

.outline_glyph path,
path.outline_glyph {
  transition: 0.2s fill stroke;
}
.hover .typst-text {
  --glyph_fill: #66bab7;
  --glyph_stroke: #66bab7;
}

.typst-jump-ripple,
.typst-debug-react-ripple {
  width: 0;
  height: 0;
  background-color: transparent;
  position: absolute;
  border-radius: 50%;
}
.typst-jump-ripple {
  border: 1px solid #66bab7;
}
.typst-debug-react-ripple {
  border: 1px solid #cb1b45;
}
@keyframes typst-jump-ripple-effect {
  to {
    width: 10vw;
    height: 10vw;
    opacity: 0.01;
    margin: -5vw;
  }
}
@keyframes typst-debug-react-ripple-effect {
  to {
    width: 3vw;
    height: 3vw;
    opacity: 0.01;
    margin: -1.5vw;
  }
}
</style>
<script>/// https://segmentfault.com/a/1190000016574288
(function () {
  var ie = !!(window.attachEvent && !window.opera);
  var wk = /webkit\/(\d+)/i.test(navigator.userAgent) && RegExp.$1 < 525;
  var fn = [];
  var run = function () {
    for (var i = 0; i < fn.length; i++) fn[i]();
  };
  var d = document;
  d.ready = function (f) {
    if (!ie && !wk && d.addEventListener) return d.addEventListener('DOMContentLoaded', f, false);
    if (fn.push(f) > 1) return;
    if (ie)
      (function () {
        try {
          d.documentElement.doScroll('left');
          run();
        } catch (err) {
          setTimeout(arguments.callee, 0);
        }
      })();
    else if (wk)
      var t = setInterval(function () {
        if (/^(loaded|complete)$/.test(d.readyState)) clearInterval(t), run();
      }, 0);
  };
})();
</script>
<script type="module" src="/typst/typst-main.js"></script><script src="/typst/svg-utils.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body><div class="container" id="stage"><div class="row"><div class="col-sm-3 col-xs-12 side-container invisible" id="side-bar"><div class="vertical-text site-title"><h3 class="site-title-small" tabindex="-1"><a class="a-title" href="/">Lights and Shadows</a></h3><h1 class="site-title-large" tabindex="-1"><a class="a-title" href="/">魔泡树的光与影</a></h1><!--h6(onclick="triggerSiteNav()") Trigger--></div><br class="visible-lg visible-md visible-sm"><div class="site-title-links" id="site-nav"><ul><li><a href="/">首页</a></li><li><a href="/archives">归档</a></li><li><a href="/categories">分类</a></li><li><a href="/tags">标签</a></li><li class="soc"><a href="https://github.com/LeptusHe" target="_blank" rel="noopener noreferrer" aria-label="Github"><i class="fa fa-github">&nbsp;</i></a><a href="http://example.com/atom.xml" target="_blank" rel="noopener noreferrer" aria-label="RSS"><i class="fa fa-rss">&nbsp;</i></a></li></ul><div class="visible-lg visible-md visible-sm site-nav-footer"><br class="site-nav-footer-br"><footer><p>&copy;&nbsp;2024&nbsp;<a target="_blank" href="http://example.com" rel="noopener noreferrer">Leptus He</a></p><p>Theme&nbsp;<a target="_blank" href="https://github.com/SumiMakito/hexo-theme-typography" rel="noopener noreferrer">Typography</a>&nbsp;by&nbsp;<a target="_blank" href="https://www.keep.moe" rel="noopener noreferrer">Makito</a></p><p>Proudly published with&nbsp;<a target="_blank" href="https://hexo.io" rel="noopener noreferrer">Hexo</a></p></footer></div></div></div><div class="col-sm-9 col-xs-12 main-container invisible" id="main-container"><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post-container-detail"><p class="post-title"><a>Temporal Antialiasing - 02</a></p><p class="post-meta"><span class="date meta-item">发布于&nbsp;2019-03-11</span><span class="meta-item"><i class="fa fa-folder"></i><span>&nbsp;</span><a class="a-tag" href="/categories/图形渲染/" title="图形渲染">图形渲染</a><span>&nbsp;</span></span><span class="meta-item"><i class="fa fa-tag"></i><span>&nbsp;</span><a class="a-tag" href="/tags/Temporal-Antialiasing/" title="Temporal Antialiasing">Temporal Antialiasing</a><span>&nbsp;</span></span></p><p class="post-abstract"><script>window.typstBindSvgDom = function () {};
window.captureStack = function () {
  return undefined;
};
let appContainer = document.currentScript && document.currentScript.parentElement;

const appElem = document.createElement('div');
if (appContainer) {
  appContainer.appendChild(appElem);
}
appElem.classList.add('typst-app');

function getViewport(appElem) {
  const domScale = 1.5;
  const appPos = appElem.getBoundingClientRect();
  const left = appPos.left;
  const top = -appPos.top;
  const right = window.innerWidth;
  const bottom = window.innerHeight - appPos.top;
  const rect = {
    x: 0,
    y: top / domScale,
    width: Math.max(right - left, 0) / domScale,
    height: Math.max(bottom - top, 0) / domScale,
  };
  if (rect.width <= 0 || rect.height <= 0) {
    rect.x = rect.y = rect.width = rect.height = 0;
  }
  // console.log('ccc', basePos, appPos, rect);
  return rect;
}

// prefetch
let tsModule = fetch(`/typst/typst_ts_renderer_bg.wasm`);
let tsData = fetch(`/artifacts/typst/source/_posts/temporal-antialiasing/temporal-antialiasing-02.multi.sir.in`);

let prevHovers = void 0;
function updateHovers(elems) {
  if (prevHovers) {
    for (const h of prevHovers) {
      h.classList.remove("focus");
    }
  }
  prevHovers = elems;
}
let globalSemaLabels = [];

document.ready(() => {
  let plugin = window.TypstRenderModule.createTypstRenderer();
  console.log(plugin);

  let session = undefined;

  let initialRender = true;
  const typstBindCustomSemantics = async (root, svg, semantics) => {
    console.log('bind custom semantics', root, svg, semantics);
    const customs = await plugin.getCustomV1({
      renderSession: session,
    });
    const semaLabel = customs.find(k => k[0] === 'sema-label');
    if (semaLabel) {
      const labelBin = semaLabel[1];
      const labels = JSON.parse(dec.decode(labelBin));
      globalSemaLabels = labels.map(([label, pos]) => {
        const [_, u, x, y] = pos.split(/[pxy]/).map(Number.parseFloat);
        return [encodeURIComponent(label), svg, [u, x, y]];
      });
    }

    // postProcessCrossLinks(semantics);

    // todo: out of page
    if (window.location.hash) {
      // console.log('hash', window.location.hash);

      // parse location.hash = `loc-${page}x${x.toFixed(2)}x${y.toFixed(2)}`;
      const hash = window.location.hash;
      const firstSep = hash.indexOf('-');
      // console.log('jump label', window.location.hash, firstSep, globalSemaLabels);
      if (firstSep != -1 && hash.slice(0, firstSep) === '#label') {
        const labelTarget = hash.slice(firstSep + 1);
        for (const [label, dom, pos] of globalSemaLabels) {
          if (label === labelTarget) {
            const [_, x, y] = pos;
            // console.log('jump label', label, pos);
            window.handleTypstLocation(dom, 1, x, y, {
              behavior: initialRender ? 'smooth' : 'instant',
            });
            initialRender = false;
            break;
          }
        }
      }
    }
  };

  window.typstBindCustomSemantics = (root, svg, semantics) =>
    setTimeout(() => typstBindCustomSemantics(root, svg, semantics), 0);

  const baseHandleTypstLocation = window.handleTypstLocation;
  window.handleTypstLocation = (elem, page, x, y, options) => {
    const docRoot = findAncestor(elem, 'typst-app');
    if (!docRoot) {
      console.warn('no typst-app found', elem);
      return;
    }

    console.log(docRoot);
    options = options || {};
    options.isDom = true;

    for (const h of docRoot.children) {
      if (h.classList.contains('typst-dom-page')) {
        const idx = Number.parseInt(h.getAttribute('data-index'));
        if (idx + 1 === page) {
          const svg = h.querySelector('.typst-svg-page');
          if (svg) {
            baseHandleTypstLocation(svg, page, x, y, options);
          }
          return;
        }
      }
    }
  };

  window.assignSemaHash = (u, x, y) => {
    // console.log(`find labels ${u}:${x}:${y} in`, globalSemaLabels);
    for (const [label, dom, pos] of globalSemaLabels) {
      const [u1, x1, y1] = pos;
      if (u === u1 && Math.abs(x - x1) < 0.01 && Math.abs(y - y1) < 0.01) {
        location.hash = `label-${label}`;
        // const domX1 = x1 * dom.viewBox.baseVal.width;
        // const domY1 = y1 * dom.viewBox.baseVal.height;

        window.typstCheckAndRerender?.(false, new Error('assignSemaHash')).then(() => {
          const width = dom.viewBox.baseVal.width;
          const height = dom.viewBox.baseVal.height;
          const bbox = dom.getBoundingClientRect();
          const domX1 = bbox.left + (x1 / width) * bbox.width;
          const domY1 = bbox.top + (y1 / height) * bbox.height;

          const lnk = findLinkInSvg(dom, [domX1, domY1]);
          if (!lnk) {
            return;
          }
          // const semaLinkLocation = document.getElementById(`typst-label-${label}`);
          const relatedElems = window.typstGetRelatedElements(lnk);
          for (const h of relatedElems) {
            h.classList.add('focus');
          }
          updateHovers(relatedElems);
          return;
        });
        return;
      }
    }
    updateHovers([]);
    // todo: multiple documents
    location.hash = `loc-${u}x${x.toFixed(2)}x${y.toFixed(2)}`;
  };

  let initialized = plugin.init({ getModule: () => tsModule });

  initialized = initialized
    .then(() => tsData)
    .then(response => response.arrayBuffer())
    .then(buffer => new Uint8Array(buffer));

  initialized = initialized.then(artifactData => {
    return new Promise(resolve => {
      plugin.runWithSession(
        ses =>
          new Promise(dispose => {
            // ignore dispose
            void dispose;

            session = ses;

            const t = performance.now();
            const dom = plugin.renderDom({
              renderSession: ses,
              container: appElem,
              pixelPerPt: 4.5,
              domScale: 1.5,
            });

            dom.then((dom) => {
              console.log(dom);
              dom.addChangement(['new', artifactData]);
              console.log('render time!!!!!!!!!', performance.now() - t);

              window.addEventListener('resize', () => dom.addViewportChange());
              window.addEventListener('scroll', () => dom.addViewportChange());
            })
          }),
      );
    });
  });
});
</script></p></div><div class="share"><span>分享到</span>&nbsp;<span class="soc"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></span><span class="soc"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></span><span class="soc"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=http://example.com/2019/03/11/temporal-antialiasing/temporal-antialiasing-02/%20Walking in Pixels%20Temporal Antialiasing - 02"></a></span></div><div class="pagination"><p class="clearfix"><span class="pre pagbuttons"><a role="navigation" href="/2023/07/04/spherical-harmonics/spherical-harmonics-01-function-fitting/" title="球谐函数01 - 函数拟合"><i class="fa fa-angle-double-left"></i>&nbsp;上一篇: 球谐函数01 - 函数拟合</a></span><span>&nbsp;</span><span class="next pagbuttons"><a role="navigation" href="/2019/03/09/temporal-antialiasing/temporal-antialiasing-01/" title="Temporal Antialiasing - 01">下一篇: Temporal Antialiasing - 01&nbsp;<i class="fa fa-angle-double-right"></i></a></span></p></div><div id="gitalk-container"></div><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js"></script><script>var gitalk = new Gitalk({
    clientID: 'Ov23liWBkDHnxftzyPvw',
    clientSecret: 'c16c4433baadd63298870c894e5de48567786c06',
    repo: 'LeptusHe.github.io',
    owner: 'LeptusHe',
    admin: ['LeptusHe'],
    id: md5(location.pathname),      // Ensure uniqueness and length less than 50
    distractionFreeMode: 'false'  // Facebook-like distraction free mode
})
gitalk.render('gitalk-container')</script></div></div></div><div class="visible-xs site-bottom-footer"><footer><p>&copy;&nbsp;2024&nbsp;<a target="_blank" href="http://example.com" rel="noopener noreferrer">Leptus He</a></p><p>Theme&nbsp;<a target="_blank" href="https://github.com/SumiMakito/hexo-theme-typography" rel="noopener noreferrer">Typography</a>&nbsp;by&nbsp;<a target="_blank" href="https://www.keep.moe" rel="noopener noreferrer">Makito</a></p><p>Proudly published with&nbsp;<a target="_blank" href="https://hexo.io" rel="noopener noreferrer">Hexo</a></p></footer></div></div></div></div><script src="/js/jquery-3.1.0.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/google-analytics.js"></script><script src="/js/typography.js"></script></body></html>